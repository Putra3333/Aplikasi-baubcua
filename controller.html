<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Controller Hewan</title>
  <style>
    body { 
      font-family:sans-serif; 
      background:#222; 
      color:#fff; 
      display:flex; 
      justify-content:center; 
      padding:20px; 
    }
    .panel { 
      background:#333; 
      padding:20px; 
      border-radius:12px; 
      width:320px; 
      text-align:center; 
    }
    .animals { 
      display:grid; 
      grid-template-columns:repeat(3,1fr); 
      gap:10px; 
      margin-bottom:10px; 
    }
    .animal { 
      font-size:36px; 
      background:#555; 
      border-radius:10px; 
      padding:10px; 
      cursor:pointer; 
    }
    .animal.active { 
      background:#00cc66; 
    }
    button { 
      padding:10px 15px; 
      margin:5px; 
      border:none; 
      border-radius:6px; 
      cursor:pointer; 
      font-weight:bold; 
    }
    .primary { background:#007bff; color:#fff; }
    .chosen { 
      margin:12px 0; 
      font-size:22px; 
      background:#444; 
      padding:8px; 
      border-radius:8px; 
    }
  </style>
</head>
<body>
  <div class="panel">
    <h2>Kontrol Hewan</h2>
    
    <!-- Grid Hewan -->
    <div class="animals" id="animals">
      <div class="animal" data-h="🦌">🦌</div>
      <div class="animal" data-h="🍶">🍶</div>
      <div class="animal" data-h="🐓">🐓</div>
      <div class="animal" data-h="🐟">🐟</div>
      <div class="animal" data-h="🦀">🦀</div>
      <div class="animal" data-h="🦐">🦐</div>
    </div>
    
    <!-- Indikator pilihan -->
    <div class="chosen" id="chosen">Pilihan: -</div>
    
    <!-- Tombol Kirim -->
    <div>
      <button class="primary" id="btnShow">Pakai Pilihan</button>
    </div>
  </div>

  <script>
    const animals = document.querySelectorAll('.animal');
    let selected = [];

    // --- WebSocket setup ---
    let socket;
    try {
      socket = new WebSocket("wss://jagoanssh:443"); // ganti IP server
      socket.onopen = () => console.log("WS connected (controller)");
      socket.onclose = () => console.log("WS closed");
      socket.onerror = err => console.error("WS error", err);
    } catch(err) {
      console.error("WS init error", err);
    }

    function updateChosen(){
      document.getElementById("chosen").textContent = 
        "Pilihan: " + (selected.length ? selected.join(" ") : "-");
    }

    function resetPilihan(){
      selected = [];
      animals.forEach(a => a.classList.remove('active'));
      updateChosen();
    }

    animals.forEach(a => {
      a.addEventListener('click', () => {
        if (selected.length < 3) {
          selected.push(a.dataset.h);
          a.classList.add('active');
        } else {
          alert("Maksimal 3 hewan. Pilihan akan dikirim.");
        }
        updateChosen();
      });
    });

    document.getElementById("btnShow").onclick = () => {
      if (selected.length !== 3) {
        alert("Harus pilih tepat 3 hewan!");
        return;
      }
      const msg = { type:"show", hewan: [...selected] };
      if(socket && socket.readyState === WebSocket.OPEN){
        socket.send(JSON.stringify(msg));
        console.log("Dikirim WS:", msg);
      } else {
        alert("WebSocket belum tersambung!");
      }
      resetPilihan();
    };

    updateChosen();
  </script>
</body>
</html>